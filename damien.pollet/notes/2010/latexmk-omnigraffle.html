<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="Website of Damien Pollet, Ph.D
" />
		<meta name="keywords" content="software engineering, programming languages, reengineering, visualisation, virtual machines, object-oriented
" />
		<meta name="author" content="Damien Pollet" />
		<meta name="generator" content="webgen - http://webgen.rubyforge.org" />
		<link rel="stylesheet" type="text/css" href="../../stylesheets/screen.css" media="screen,projection" />
		
		<link rel="icon" type="image/png" href="../../images/icon.png" />

		<title>Damien Pollet — Integrating OmniGraffle and Latexmk</title>
		<script type="text/javascript" src="../../scripts/hyphenator-packed.js"></script>
		<script type="text/javascript" src="../../scripts/jquery-1.4.3.min.js"></script>
		<script type="text/javascript" src="../../scripts/footnotes.js"></script>
		<script type="text/javascript" src="../../scripts/konami.pack.js"></script>
		<script type="text/javascript">
			var k = new Konami();
			k.code = function() {
				document.getElementById("konami").style.display = "inline";
				var cssLink = document.createElement("link");
				cssLink.href = "../../stylesheets/konami.css";
				cssLink.rel = "stylesheet";
				cssLink.type = "text/css";
				document.body.appendChild(cssLink);
			};
			k.load();
		</script>
	</head>

	<body>
		<div id="pagetop" class="hide">
			<p>Skip to: <a href="#menu" accesskey="2">Site menu</a> | <a href="#main" accesskey="3">Main content</a></p>
		</div>

		<div id="container">
			<div id="header">
				<h1><a href="../../index.html" accesskey="4">Damien Pollet</a></h1>
				<div id="tagline">Assistant professor, <a href="http://www.univ-lille1.fr">university of Lille 1, France</a><br/> <em>object-oriented software (re)engineering &amp; language design</em>
</div>
				<div class="clear">&nbsp;</div>
				<div id="menu"><ul><li class="webgen-menu-level1"><a href="../../index.html">Home</a></li><li class="webgen-menu-level1 webgen-menu-submenu"><a href="../../publications/index.html">Publications</a></li><li class="webgen-menu-level1 webgen-menu-submenu"><a href="../../research/index.html">Research</a></li><li class="webgen-menu-level1 webgen-menu-submenu"><a href="../../teaching/index.html">Teaching</a></li><li class="webgen-menu-level1"><a href="../../curriculum.html">CV</a></li><li class="webgen-menu-level1"><a href="../../contact.html">Contact</a></li><li class="webgen-menu-level1 webgen-menu-submenu webgen-menu-submenu-inhierarchy"><a href="../index.html">Notes</a></li></ul></div>
				<div id="langbar"></div>
				<div class="clear">&nbsp;</div>
			</div>

			<div id="main" class="hyphenate">
				
				
<h1 id="integrating-omnigraffle-and-latexmk">Integrating OmniGraffle and Latexmk</h1>

<p><img alt="Cast type" class="right" src="../images/letterpress.jpg" title="CC-BY http://www.flickr.com/photos/wilhei/109403747" /></p>

<div class="postmeta">
  <span class="date">24 Jan 2010</span>
  <span class="tags">
    in <a href="../index.latex.html">latex</a>
  </span>
</div>

<p>Compiling LaTeX documents can be quite a hassle, because it&rsquo;s an iterative process, and the dependancies are not really clear.
There is one gem of a tool, however, that any regular LaTeXer should know: <a href="http://www.phys.psu.edu/~collins/software/latexmk-jcc/" title="Latexmk's home page">Latexmk</a>.</p>

<p>Latexmk handles all the common TeX pipelines (DVI, PS, PDF…), detects most if not all the dependancies if your document is split into several source files, and will (re-)run LaTeX, BibTeX, etc. as needed, effectively reducing building most documents to this invocation:</p>

<pre><code>$ latexmk
</code></pre>

<p>Very nice indeed, but what about figures created in an external editor like <a href="http://www.omnigroup.com/applications/OmniGraffle/" title="OmniGroup's diagramming application">OmniGraffle</a>? Going through OmniGraffle&rsquo;s menus to export documents to PDF after each change quickly gets boring.</p>

<h2 id="exporting-from-omnigraffle-automatically">Exporting from OmniGraffle automatically</h2>

<p>First of all, we need a way to <a href="http://code.untyped.org/gitweb/gitweb.cgi?p=infrastructure.git;a=blob;f=tools/graffle2pdf" title="graffle2pdf">convert a <code>.graffle</code> file to PDF automatically</a><sup id="fnref:beware"><a href="#fn:beware" rel="footnote">1</a></sup>.
My solution was a short Ruby wrapper around an AppleScript invocation, but I guess Automator would work as well.
Just drop the script somewhere in your <code>$PATH</code> and make sure it&rsquo;s executable.
I didn&rsquo;t pay much attention to making the invocation flexible, because I only use it in an automatic way, so both input and output file names have to be specified explicitely:</p>

<pre><code>$ graffle2pdf figure.graffle figure.pdf
</code></pre>

<p>By the way, my script also includes the rule to use it with <a href="http://www.gnu.org/software/make/" title="GNU Make">Make</a>, just run <code>graffle2pdf &gt;&gt; Makefile</code> to append it:</p>

<pre><code>.SUFFIXES: .graffle .pdf
.graffle.pdf:
        @echo Converting $&lt; to PDF...
        @graffle2pdf $&lt; $@
</code></pre>

<h2 id="adding-a-custom-rule-to-latexmk">Adding a custom rule to Latexmk</h2>

<p>Latexmk already has many rules to handle the many steps in compiling a LaTeX document, and it&rsquo;s possible to specify more. Here&rsquo;s the one to call <code>graffle2pdf</code>:</p>

<pre><code>add_cus_dep( 'graffle', 'pdf', 0, 'graffle2pdf' );
sub graffle2pdf {
   system(&quot;graffle2pdf $_[0].graffle $_[0].pdf&quot;);
}
</code></pre>

<p>Append these lines to your <code>~/.latexmkrc</code> file, and you&rsquo;re done. The first line indicates to Latexmk that it can obtain a <code>.pdf</code> file from a <code>.graffle</code> one by calling the Perl procedure below. In this case it invokes the <code>graffle2pdf</code> script, but since this is Perl, it could do everything in place. Also, since this is Perl, the least I had to deal with it, the better :-)</p>

<p>For the curious, there are many more additional rules in the <a href="http://ctan.tug.org/tex-archive/support/latexmk/example_rcfiles/">example config file on CTAN</a>.</p>

<h2 id="basic-latexmk-configuration">Basic Latexmk configuration</h2>

<p>My LaTeX pipeline of choice is PDFLaTeX; here are a few more options in <code>~/.latexmkrc</code> that I found useful:</p>

<pre><code>$pdf_mode = 1;
$pdflatex = 'pdflatex -8bit -etex -file-line-error -halt-on-error -synctex=1 %O %S';
$pdf_previewer = 'open %S';
$pdf_update_method = 0;
$clean_ext = &quot;synctex.gz&quot;;

@default_files = ('main.tex');
</code></pre>

<p>From top to bottom, these tell Latexmk:
- to generate PDF via <code>pdflatex</code>, with some options to get better command-line behavior and to activate <a href="http://en.foursenses.net/usingsynctex">SyncTeX</a> for jumping between editor and previewer (PDFsync has some strange interactions with style files we use);
- to open the generated PDF file the Mac way (I&rsquo;m using <a href="http://skim-app.sourceforge.net/">Skim</a>, for SyncTeX support);
- to include the SyncTeX file in the garbage when cleaning (<code>latexmk -C</code>).</p>

<p>The last line specifies that the document to compile is often named <code>main.tex</code>, so I can just type <code>latexmk</code> to build without thinking<sup id="fnref:lmk"><a href="#fn:lmk" rel="footnote">2</a></sup>. This convention can be overridden on a per-document basis by setting the correct value for <code>@default_files</code> in a <code>.latexmkrc</code> or <code>latexmkrc</code> file besides the LaTeX sources.</p>

<p><em>Happy LaTeXing!</em></p>

<div class="footnotes">
  <ol>
    <li id="fn:beware">
      <p>Beware, the script contains a couple Unicode chevrons (<code>«class ppth»</code>) that gitweb garbles in the <a href="http://code.untyped.org/gitweb/gitweb.cgi?p=infrastructure.git;a=blob_plain;f=tools/graffle2pdf">raw view</a>; they are correct in the <a href="http://code.untyped.org/gitweb/gitweb.cgi?p=infrastructure.git;a=blob;f=tools/graffle2pdf" title="graffle2pdf">blob view</a>.<a href="#fnref:beware" rev="footnote">&#8617;</a></p>
    </li>
    <li id="fn:lmk">
      <p>In fact I have a shell alias that shortens that to just <code>lmk</code> :-)<a href="#fnref:lmk" rev="footnote">&#8617;</a></p>
    </li>
  </ol>
</div>

				<div class="clear">&nbsp;</div>
			</div>

			
			<div class="clear">&nbsp;</div>
		</div>

		<div id="pagebottom">
			<p>Last updated on 2011-01-25.&emsp;
				Generated by
				<a href="http://webgen.rubyforge.org">webgen</a>,
				<a href="http://sass-lang.com">sass</a>,
				<a href="http://daringfireball.net/projects/markdown/">markdown</a>/<a href="http://kramdown.rubyforge.org">kramdown</a>,
				<a href="http://www.ruby-lang.org/en/">ruby</a>,
				<a href="http://code.google.com/p/hyphenator/">hyphenator.js</a>
				(toggle <a id="HyphenatorToggleBox" class="donthyphenate" onclick="Hyphenator.toggleHyphenation();">hy-phe-na-ti-on</a>)&hellip;
				<span id="konami" style="display:none;">and <a href="http://konami-js.googlecode.com">konami.js</a>!</span>
				<br/>
				Some rights reserved.&emsp;
				Except where otherwise noted, this website by <a xmlns:cc="http://creativecommons.org/ns#" href="http://people.untyped.org/damien.pollet" property="cc:attributionName" rel="cc:attributionURL">Damien Pollet</a><br/>
				is licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.0/fr/">Creative Commons Attribution-Share Alike 2.0 France</a>.
				<br/>
				<img alt="Creative Commons License" style="margin-top:1ex;border-width:0" src="../../images/cc-by-sa-80x15.png" />
			</p>
			<a class="hide" href="#pagetop" accesskey="1">Back to top</a>
		</div>

		<script type="text/javascript">
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-718463-2']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script');
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				ga.setAttribute('async', 'true');
				document.documentElement.firstChild.appendChild(ga);
			})();
		</script>
	</body>
</html>
